<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
      "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
          "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<!--
      <generator class="hilo">
        <param name="max_lo">100</param>
      </generator>
-->

<hibernate-mapping package="org.eigenbase.enki.prototype">

  <class name="BarCmdImpl">
    <id name="id"> <!-- Cmd -->
      <generator class="org.eigenbase.enki.prototype.MofIdGenerator">
        <param name="interval">100</param>
      </generator>
    </id>
    <property name="name"/> <!-- Cmd -->
    <property name="bar"/>

    <!-- unique="true" makes this one-to-one or one-to-zero -->
    <many-to-one
      name="thingyAssociation"
      class="OneToManyAssociation"
      unique="true"
      not-null="false"
      cascade="save-update"/>
  </class>

  <class name="FooBarCmdImpl">
    <id name="id"> <!-- Cmd -->
      <generator class="org.eigenbase.enki.prototype.MofIdGenerator">
        <param name="interval">100</param>
      </generator>
    </id>
    <property name="name"/> <!-- Cmd -->
    <property name="foo"/> <!-- Foo -->
    <property name="bar"/> <!-- Bar -->

    <!-- unique="true" makes this one-to-one or one-to-zero -->
    <many-to-one
      name="thingyAssociation"
      class="OneToManyAssociation"
      unique="true"
      not-null="false"
      cascade="save-update"/>

    <property name="foobar"/>
  </class>

  <class name="ThingyImpl">
    <id name="id">
      <generator class="org.eigenbase.enki.prototype.MofIdGenerator">
        <param name="interval">100</param>
      </generator>
    </id>
    <property name="name"/>

    <!-- unique="true" makes this one-to-one or one-to-zero -->
    <many-to-one
      name="barAssociation"
      class="OneToManyAssociation"
      unique="true"
      not-null="false"
      cascade="save-update"/>
  </class>

  <class name="DoodadImpl">
    <id name="id"> <!-- Thingy -->
      <generator class="org.eigenbase.enki.prototype.MofIdGenerator">
        <param name="interval">100</param>
      </generator>
    </id>
    <property name="name"/> <!-- Thingy -->
    <property name="doodadMode"/>

    <!-- unique="true" makes this one-to-one or one-to-zero -->
    <many-to-one
      name="barAssociation"
      class="OneToManyAssociation"
      unique="true"
      not-null="false"
      cascade="save-update"/>
  </class>

  <class name="OneToManyAssociation" table="AssocOneToMany">
    <id name="id">
      <generator class="org.eigenbase.enki.prototype.MofIdGenerator">
        <param name="interval">100</param>
      </generator>
    </id>
    <property 
      name="type"
      not-null="true"
      unique-key="parent_id_type_unique"
      length="64"/>

    <any name="parent" id-type="long" meta-type="string">
      <!-- should replace this with generated custom mapping class -->
      <meta-value value="BarCmd" class="BarCmdImpl"/>
      <meta-value value="FooBarCmd" class="FooBarCmdImpl"/>

      <column name="parent_type"/>
      <column name="parent_id" unique-key="parent_id_type_unique"/>
    </any>

    <list 
      name="children" 
      table="AssocOneToManyChildren" 
      cascade="save-update" 
      fetch="join">

      <key column="child_key"/>
      <list-index column="child_ordinal"/>
      <many-to-any id-type="long" meta-type="string">
        <meta-value value="Thingy" class="ThingyImpl"/>
        <meta-value value="Doodad" class="DoodadImpl"/>
        <column name="child_type" length="64"/>
        <column name="child_id"/>
      </many-to-any>
    </list>
  </class>
  
  <class name="ManyToManyAssociation" table="AssocManyToMany">
    <id name="id">
      <generator class="org.eigenbase.enki.prototype.MofIdGenerator">
        <param name="interval">100</param>
      </generator>
    </id>
    <property 
      name="type"
      not-null="true"
      length="64"/>

    <list 
      name="left" 
      table="AssocManyToManyLeft" 
      cascade="save-update" 
      fetch="join">

      <key column="child_key"/>
      <list-index column="child_ordinal"/>
      <many-to-any id-type="long" meta-type="string">
        <meta-value value="Thingy" class="ThingyImpl"/>
        <meta-value value="Doodad" class="DoodadImpl"/>
        <column name="child_type" length="64"/>
        <column name="child_id"/>
      </many-to-any>
    </list>

    <list 
      name="right" 
      table="AssocManyToManyRight" 
      cascade="save-update" 
      fetch="join">

      <key column="child_key"/>
      <list-index column="child_ordinal"/>
      <many-to-any id-type="long" meta-type="string">
        <meta-value value="Thingy" class="ThingyImpl"/>
        <meta-value value="Doodad" class="DoodadImpl"/>
        <column name="child_type" length="64"/>
        <column name="child_id"/>
      </many-to-any>
    </list>

  </class>
</hibernate-mapping>
